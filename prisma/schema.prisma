// Prisma Schema for Viralfluencer Platform
// PostgreSQL Database with comprehensive influencer marketing models

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// ==================== ENUMS ====================

enum UserRole {
  ADMIN
  BRAND
  INFLUENCER
}

enum CompanySize {
  STARTUP_1_10
  SMALL_11_50
  MEDIUM_51_200
  LARGE_201_500
  ENTERPRISE_501_1000
  ENTERPRISE_1000_PLUS
}

enum CampaignStatus {
  DRAFT
  ACTIVE
  IN_PROGRESS
  PAUSED
  COMPLETED
  CANCELLED
}

enum CampaignVisibility {
  PUBLIC
  PRIVATE
  INVITE_ONLY
}

enum CompensationType {
  FIXED
  PERFORMANCE
  PRODUCT
  HYBRID
}

enum ApplicationStatus {
  PENDING
  SHORTLISTED
  ACCEPTED
  REJECTED
  WITHDRAWN
}

enum DeliverableStatus {
  PENDING
  IN_PROGRESS
  SUBMITTED
  REVISION_REQUESTED
  APPROVED
  REJECTED
}

enum ContentType {
  IMAGE
  VIDEO
  REEL
  STORY
  POST
}

enum ContentStatus {
  DRAFT
  PENDING_REVIEW
  APPROVED
  PUBLISHED
  REJECTED
  ARCHIVED
}

enum Platform {
  INSTAGRAM
  TIKTOK
  YOUTUBE
  TWITTER
  FACEBOOK
  LINKEDIN
}

enum NotificationType {
  CAMPAIGN_INVITE
  CAMPAIGN_APPLICATION
  CAMPAIGN_ACCEPTED
  CAMPAIGN_REJECTED
  MESSAGE
  PAYMENT
  CONTENT_APPROVED
  CONTENT_REVISION
  DEADLINE_REMINDER
  MILESTONE
  SYSTEM
}

enum PaymentStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  REFUNDED
}

enum MessageStatus {
  SENT
  DELIVERED
  READ
}

enum AvailabilityStatus {
  AVAILABLE
  BUSY
  BOOKED
}

enum Gender {
  MALE
  FEMALE
  ALL
  OTHER
}

// ==================== USER MODELS ====================

model User {
  id                  String    @id @default(cuid())
  email               String    @unique
  passwordHash        String
  name                String
  role                UserRole
  avatar              String?
  emailVerified       Boolean   @default(false)
  emailVerifiedAt     DateTime?
  onboardingCompleted Boolean   @default(false)
  isActive            Boolean   @default(true)
  lastLoginAt         DateTime?
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt

  // Relations
  brand            Brand?
  influencer       Influencer?
  sessions         Session[]
  passwordResets   PasswordReset[]
  notifications    Notification[]
  sentMessages     Message[]                 @relation("SentMessages")
  receivedMessages Message[]                 @relation("ReceivedMessages")
  conversations    ConversationParticipant[]

  // Phase 1: Collaboration & Payments
  collaborationMessages CollaborationMessage[]
  wallet                Wallet?
  payoutMethods         PayoutMethod[]
  reputationScore       ReputationScore?
  verificationRequests  VerificationRequest[]
  disputesRaised        Dispute[]              @relation("DisputeRaiser")
  disputesAgainst       Dispute[]              @relation("DisputeAgainst")

  // Phase 2: Social Feed & CRM
  feedPosts     FeedPost[]
  feedLikes     FeedLike[]
  feedComments  FeedComment[]
  feedShares    FeedShare[]
  feedPollVotes FeedPollVote[]
  following     UserFollow[]   @relation("Following")
  followers     UserFollow[]   @relation("Followers")

  // Phase 3: Monetization
  subscriptions Subscription[]
  usageRecords  UsageRecord[]

  // Phase 4: Platform Completeness
  messageReactions       MessageReaction[]
  contentApprovalSteps   ContentApprovalStep[]
  searchHistories        SearchHistory[]
  teamMemberships        TeamMember[]
  connectedApps          ConnectedApp[]
  webhooks               Webhook[]
  apiKeys                APIKey[]
  alertRules             AlertRule[]
  notificationPreference NotificationPreference?

  @@index([email])
  @@index([role])
  @@index([createdAt])
}

model Session {
  id           String   @id @default(cuid())
  userId       String
  token        String   @unique
  refreshToken String   @unique
  userAgent    String?
  ipAddress    String?
  expiresAt    DateTime
  createdAt    DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([token])
  @@index([refreshToken])
  @@index([expiresAt])
}

model PasswordReset {
  id        String    @id @default(cuid())
  userId    String
  token     String    @unique
  expiresAt DateTime
  usedAt    DateTime?
  createdAt DateTime  @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([token])
  @@index([userId])
}

model EmailVerification {
  id         String    @id @default(cuid())
  email      String
  token      String    @unique
  expiresAt  DateTime
  verifiedAt DateTime?
  createdAt  DateTime  @default(now())

  @@index([token])
  @@index([email])
}

// ==================== BRAND MODELS ====================

model Brand {
  id          String       @id @default(cuid())
  userId      String       @unique
  companyName String
  logo        String?
  coverImage  String?
  industry    String
  website     String?
  description String?
  location    String?
  companySize CompanySize?
  foundedYear Int?
  verified    Boolean      @default(false)
  verifiedAt  DateTime?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  // Relations
  user               User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  preferences        BrandPreferences?
  settings           BrandSettings?
  campaigns          Campaign[]
  savedInfluencers   SavedInfluencer[]
  blockedInfluencers BlockedInfluencer[]
  reviewsGiven       InfluencerReview[]
  reviewsReceived    BrandReview[]
  payments           Payment[]

  // Phase 1: Collaboration & Payments
  collaborations    Collaboration[]
  escrowAccounts    EscrowAccount[]
  contractTemplates ContractTemplate[]
  invoices          Invoice[]

  // Phase 2: CRM & Marketplace
  crmContacts         CRMContact[]
  crmLists            CRMList[]
  marketplaceListings MarketplaceListing[]

  // Phase 3: AI
  aiMatchScores AIMatchScore[]

  // Phase 4: Platform Completeness
  comparisons        InfluencerComparison[]
  productCatalog     ProductCatalog[]
  giftingOrders      GiftingOrder[]
  organization       Organization?
  reportTemplates    ReportTemplate[]
  generatedReports   GeneratedReport[]
  outreachTemplates  OutreachTemplate[]
  outreachCampaigns  OutreachCampaign[]
  brandMentions      BrandMention[]
  keywordTrackers    KeywordTracker[]
  sentimentReports   SentimentReport[]
  budgetPlans        BudgetPlan[]
  roiProjections     ROIProjection[]
  ugcContent         UGCContent[]

  @@index([userId])
  @@index([industry])
  @@index([verified])
  @@index([companyName])
}

model BrandPreferences {
  id                  String     @id @default(cuid())
  brandId             String     @unique
  preferredPlatforms  Platform[]
  preferredCategories String[]
  typicalBudgetMin    Decimal?   @db.Decimal(10, 2)
  typicalBudgetMax    Decimal?   @db.Decimal(10, 2)
  campaignGoals       String[]
  targetAgeGroups     String[]
  targetGenders       Gender[]
  targetLocations     String[]
  createdAt           DateTime   @default(now())
  updatedAt           DateTime   @updatedAt

  brand Brand @relation(fields: [brandId], references: [id], onDelete: Cascade)
}

model BrandSettings {
  id                     String   @id @default(cuid())
  brandId                String   @unique
  emailNotifications     Boolean  @default(true)
  campaignUpdates        Boolean  @default(true)
  newApplications        Boolean  @default(true)
  messageNotifications   Boolean  @default(true)
  profileVisibility      String   @default("public")
  showSpending           Boolean  @default(false)
  defaultPaymentMethodId String?
  autoRecharge           Boolean  @default(false)
  billingEmail           String?
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt

  brand Brand @relation(fields: [brandId], references: [id], onDelete: Cascade)
}

model SavedInfluencer {
  id           String   @id @default(cuid())
  brandId      String
  influencerId String
  notes        String?
  tags         String[]
  createdAt    DateTime @default(now())

  brand      Brand      @relation(fields: [brandId], references: [id], onDelete: Cascade)
  influencer Influencer @relation(fields: [influencerId], references: [id], onDelete: Cascade)

  @@unique([brandId, influencerId])
  @@index([brandId])
  @@index([influencerId])
}

model BlockedInfluencer {
  id           String   @id @default(cuid())
  brandId      String
  influencerId String
  reason       String?
  createdAt    DateTime @default(now())

  brand      Brand      @relation(fields: [brandId], references: [id], onDelete: Cascade)
  influencer Influencer @relation(fields: [influencerId], references: [id], onDelete: Cascade)

  @@unique([brandId, influencerId])
  @@index([brandId])
}

// ==================== INFLUENCER MODELS ====================

model Influencer {
  id                  String             @id @default(cuid())
  userId              String             @unique
  username            String             @unique
  fullName            String
  bio                 String?
  avatar              String?
  coverImage          String?
  location            String?
  languages           String[]
  categories          String[]
  contentTypes        String[]
  verified            Boolean            @default(false)
  verifiedAt          DateTime?
  availability        AvailabilityStatus @default(AVAILABLE)
  nextAvailableDate   DateTime?
  rating              Decimal            @default(0) @db.Decimal(2, 1)
  totalReviews        Int                @default(0)
  totalCampaigns      Int                @default(0)
  campaignSuccessRate Decimal            @default(0) @db.Decimal(5, 2)
  createdAt           DateTime           @default(now())
  updatedAt           DateTime           @updatedAt

  // Relations
  user            User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  platforms       InfluencerPlatform[]
  pricing         InfluencerPricing?
  metrics         InfluencerMetrics?
  audience        AudienceDemographics?
  settings        InfluencerSettings?
  growthTrend     GrowthTrendEntry[]
  recentPosts     RecentPost[]
  pastBrands      PastBrandCollab[]
  applications    CampaignApplication[]
  invitations     CampaignInvitation[]
  contents        Content[]
  payments        Payment[]
  savedBy         SavedInfluencer[]
  blockedBy       BlockedInfluencer[]
  reviewsReceived InfluencerReview[]
  reviewsGiven    BrandReview[]
  instagramData   InstagramProfile?

  // Phase 1: Collaboration & Payments
  collaborations Collaboration[]
  escrowAccounts EscrowAccount[]
  invoices       Invoice[]

  // Phase 2: CRM & Marketplace & Analytics
  crmContacts             CRMContact[]
  marketplaceApplications MarketplaceApplication[]
  analytics               InfluencerAnalytics?

  // Phase 3: AI
  aiMatchScores            AIMatchScore[]
  aiPricingRecommendations AIPricingRecommendation[]
  aiFraudFlags             AIFraudFlag[]

  // Phase 4: Platform Completeness
  trackingLinks  TrackingLink[]
  promoCodes     PromoCode[]
  mediaKit       MediaKit?
  giftingOrders  GiftingOrder[]
  ugcContent     UGCContent[]

  @@index([userId])
  @@index([username])
  @@index([verified])
  @@index([availability])
  @@index([rating])
  @@index([location])
}

model InfluencerPlatform {
  id             String    @id @default(cuid())
  influencerId   String
  platform       Platform
  handle         String
  profileUrl     String?
  followers      Int       @default(0)
  verified       Boolean   @default(false)
  engagementRate Decimal   @default(0) @db.Decimal(5, 2)
  avgLikes       Int       @default(0)
  avgComments    Int       @default(0)
  avgViews       Int       @default(0)
  accessToken    String?
  refreshToken   String?
  tokenExpiresAt DateTime?
  lastSyncedAt   DateTime?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  influencer Influencer @relation(fields: [influencerId], references: [id], onDelete: Cascade)

  @@unique([influencerId, platform])
  @@index([influencerId])
  @@index([platform])
  @@index([followers])
}

model InfluencerPricing {
  id             String   @id @default(cuid())
  influencerId   String   @unique
  instagramPost  Decimal? @db.Decimal(10, 2)
  instagramStory Decimal? @db.Decimal(10, 2)
  instagramReel  Decimal? @db.Decimal(10, 2)
  tiktokVideo    Decimal? @db.Decimal(10, 2)
  youtubeVideo   Decimal? @db.Decimal(10, 2)
  youtubeShort   Decimal? @db.Decimal(10, 2)
  twitterPost    Decimal? @db.Decimal(10, 2)
  facebookPost   Decimal? @db.Decimal(10, 2)
  customPricing  Json?
  currency       String   @default("USD")
  negotiable     Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  influencer Influencer @relation(fields: [influencerId], references: [id], onDelete: Cascade)
}

model InfluencerMetrics {
  id                String   @id @default(cuid())
  influencerId      String   @unique
  totalReach        BigInt   @default(0)
  avgEngagementRate Decimal  @default(0) @db.Decimal(5, 2)
  authenticityScore Int      @default(0)
  brandSafetyScore  Int      @default(0)
  responseRate      Int      @default(0)
  avgResponseTime   String?
  lastCalculatedAt  DateTime @default(now())
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  influencer Influencer @relation(fields: [influencerId], references: [id], onDelete: Cascade)
}

model AudienceDemographics {
  id            String   @id @default(cuid())
  influencerId  String   @unique
  ageRanges     Json
  genderSplit   Json
  topCountries  Json
  topCities     Json
  interests     String[]
  lastUpdatedAt DateTime @default(now())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  influencer Influencer @relation(fields: [influencerId], references: [id], onDelete: Cascade)
}

model InfluencerSettings {
  id                   String   @id @default(cuid())
  influencerId         String   @unique
  emailNotifications   Boolean  @default(true)
  campaignInvites      Boolean  @default(true)
  messageNotifications Boolean  @default(true)
  paymentNotifications Boolean  @default(true)
  profileVisibility    String   @default("public")
  showPricing          Boolean  @default(true)
  showEarnings         Boolean  @default(false)
  autoReplyEnabled     Boolean  @default(false)
  autoReplyMessage     String?
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  influencer Influencer @relation(fields: [influencerId], references: [id], onDelete: Cascade)
}

model GrowthTrendEntry {
  id             String   @id @default(cuid())
  influencerId   String
  month          DateTime @db.Date
  followers      Int
  engagementRate Decimal  @db.Decimal(5, 2)
  createdAt      DateTime @default(now())

  influencer Influencer @relation(fields: [influencerId], references: [id], onDelete: Cascade)

  @@unique([influencerId, month])
  @@index([influencerId])
}

model RecentPost {
  id             String      @id @default(cuid())
  influencerId   String
  type           ContentType
  platform       Platform
  thumbnail      String?
  postUrl        String?
  likes          Int         @default(0)
  comments       Int         @default(0)
  views          Int         @default(0)
  engagementRate Decimal     @db.Decimal(5, 2)
  postedAt       DateTime
  createdAt      DateTime    @default(now())

  influencer Influencer @relation(fields: [influencerId], references: [id], onDelete: Cascade)

  @@index([influencerId])
  @@index([postedAt])
}

model PastBrandCollab {
  id           String   @id @default(cuid())
  influencerId String
  brandName    String
  brandLogo    String?
  campaignName String?
  completedAt  DateTime
  createdAt    DateTime @default(now())

  influencer Influencer @relation(fields: [influencerId], references: [id], onDelete: Cascade)

  @@index([influencerId])
}

// ==================== CAMPAIGN MODELS ====================

model Campaign {
  id               String             @id @default(cuid())
  brandId          String
  title            String
  description      String
  longDescription  String?
  category         String
  status           CampaignStatus     @default(DRAFT)
  visibility       CampaignVisibility @default(PUBLIC)
  compensationType CompensationType   @default(FIXED)

  // Budget
  budgetMin  Decimal @db.Decimal(10, 2)
  budgetMax  Decimal @db.Decimal(10, 2)
  currency   String  @default("USD")
  totalSpent Decimal @default(0) @db.Decimal(10, 2)

  // Timeline
  applicationDeadline DateTime?
  startDate           DateTime
  endDate             DateTime
  contentDueDate      DateTime?

  // Limits
  maxInfluencers Int @default(10)

  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  publishedAt DateTime?
  completedAt DateTime?

  // Relations
  brand          Brand                   @relation(fields: [brandId], references: [id], onDelete: Cascade)
  platforms      CampaignPlatform[]
  goals          CampaignGoal[]
  requirements   CampaignRequirements?
  targetAudience CampaignTargetAudience?
  deliverables   CampaignDeliverable[]
  guidelines     CampaignGuidelines?
  applications   CampaignApplication[]
  invitations    CampaignInvitation[]
  contents       Content[]
  payments       Payment[]
  performance    CampaignPerformance?
  hashtags       CampaignHashtag[]

  // Phase 1: Collaboration Workflow
  collaborations Collaboration[]

  // Phase 2: Feed, Marketplace & Analytics
  feedPosts           FeedPost[]
  marketplaceListings MarketplaceListing[]
  campaignAnalytics   CampaignAnalytics?

  // Phase 3: AI
  aiMatchScores        AIMatchScore[]
  aiContentSuggestions AIContentSuggestion[]

  @@index([brandId])
  @@index([status])
  @@index([visibility])
  @@index([category])
  @@index([startDate])
  @@index([endDate])
  @@index([createdAt])
}

model CampaignPlatform {
  id         String   @id @default(cuid())
  campaignId String
  platform   Platform
  createdAt  DateTime @default(now())

  campaign Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)

  @@unique([campaignId, platform])
  @@index([campaignId])
}

model CampaignGoal {
  id         String   @id @default(cuid())
  campaignId String
  goal       String
  createdAt  DateTime @default(now())

  campaign Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)

  @@index([campaignId])
}

model CampaignRequirements {
  id                     String   @id @default(cuid())
  campaignId             String   @unique
  minFollowers           Int      @default(0)
  maxFollowers           Int?
  minEngagementRate      Decimal  @default(0) @db.Decimal(5, 2)
  contentTypes           String[]
  additionalRequirements String[]
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt

  campaign Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
}

model CampaignTargetAudience {
  id         String   @id @default(cuid())
  campaignId String   @unique
  ageRanges  String[]
  genders    Gender[]
  locations  String[]
  languages  String[]
  interests  String[]
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  campaign Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
}

model CampaignDeliverable {
  id           String    @id @default(cuid())
  campaignId   String
  type         String
  quantity     Int       @default(1)
  description  String?
  compensation Decimal?  @db.Decimal(10, 2)
  deadline     DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  campaign    Campaign                @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  submissions DeliverableSubmission[]

  @@index([campaignId])
}

model CampaignGuidelines {
  id              String   @id @default(cuid())
  campaignId      String   @unique
  dosList         String[]
  dontsList       String[]
  brandGuidelines String?
  exampleContent  String[]
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  campaign Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
}

model CampaignHashtag {
  id         String   @id @default(cuid())
  campaignId String
  hashtag    String
  required   Boolean  @default(true)
  createdAt  DateTime @default(now())

  campaign Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)

  @@unique([campaignId, hashtag])
  @@index([campaignId])
}

model CampaignPerformance {
  id               String   @id @default(cuid())
  campaignId       String   @unique
  totalReach       BigInt   @default(0)
  totalEngagement  BigInt   @default(0)
  totalImpressions BigInt   @default(0)
  totalClicks      BigInt   @default(0)
  totalConversions Int      @default(0)
  roi              Decimal? @db.Decimal(10, 2)
  lastCalculatedAt DateTime @default(now())
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  campaign Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
}

// ==================== APPLICATION & INVITATION MODELS ====================

model CampaignApplication {
  id              String            @id @default(cuid())
  campaignId      String
  influencerId    String
  status          ApplicationStatus @default(PENDING)
  proposal        String?
  proposedPrice   Decimal?          @db.Decimal(10, 2)
  estimatedReach  Int?
  message         String?
  rejectionReason String?
  appliedAt       DateTime          @default(now())
  reviewedAt      DateTime?
  acceptedAt      DateTime?
  rejectedAt      DateTime?
  updatedAt       DateTime          @updatedAt

  campaign   Campaign   @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  influencer Influencer @relation(fields: [influencerId], references: [id], onDelete: Cascade)
  contract   Contract?

  @@unique([campaignId, influencerId])
  @@index([campaignId])
  @@index([influencerId])
  @@index([status])
}

model CampaignInvitation {
  id           String    @id @default(cuid())
  campaignId   String
  influencerId String
  message      String?
  status       String    @default("pending")
  expiresAt    DateTime
  invitedAt    DateTime  @default(now())
  respondedAt  DateTime?
  updatedAt    DateTime  @updatedAt

  campaign   Campaign   @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  influencer Influencer @relation(fields: [influencerId], references: [id], onDelete: Cascade)

  @@unique([campaignId, influencerId])
  @@index([campaignId])
  @@index([influencerId])
  @@index([status])
  @@index([expiresAt])
}

model Contract {
  id                 String    @id @default(cuid())
  applicationId      String    @unique
  terms              String
  agreedAmount       Decimal   @db.Decimal(10, 2)
  signedByBrand      Boolean   @default(false)
  signedByInfluencer Boolean   @default(false)
  brandSignedAt      DateTime?
  influencerSignedAt DateTime?
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt

  application CampaignApplication @relation(fields: [applicationId], references: [id], onDelete: Cascade)

  @@index([applicationId])
}

// ==================== CONTENT MODELS ====================

model Content {
  id           String        @id @default(cuid())
  influencerId String
  campaignId   String?
  title        String
  description  String?
  type         ContentType
  platform     Platform
  url          String?
  thumbnail    String?
  status       ContentStatus @default(DRAFT)
  tags         String[]

  // Metrics
  views          Int      @default(0)
  likes          Int      @default(0)
  comments       Int      @default(0)
  shares         Int      @default(0)
  engagementRate Decimal? @db.Decimal(5, 2)

  publishedAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  influencer      Influencer              @relation(fields: [influencerId], references: [id], onDelete: Cascade)
  campaign        Campaign?               @relation(fields: [campaignId], references: [id])
  submissions     DeliverableSubmission[]
  revisionHistory ContentRevision[]
  approvalSteps   ContentApprovalStep[]
  ftcChecks       FTCComplianceCheck[]

  @@index([influencerId])
  @@index([campaignId])
  @@index([status])
  @@index([platform])
  @@index([createdAt])
}

model DeliverableSubmission {
  id            String            @id @default(cuid())
  deliverableId String
  contentId     String
  status        DeliverableStatus @default(SUBMITTED)
  feedback      String?
  submittedAt   DateTime          @default(now())
  reviewedAt    DateTime?
  approvedAt    DateTime?
  updatedAt     DateTime          @updatedAt

  deliverable CampaignDeliverable @relation(fields: [deliverableId], references: [id], onDelete: Cascade)
  content     Content             @relation(fields: [contentId], references: [id], onDelete: Cascade)

  @@unique([deliverableId, contentId])
  @@index([deliverableId])
  @@index([contentId])
  @@index([status])
}

model ContentRevision {
  id            String   @id @default(cuid())
  contentId     String
  version       Int
  changes       String
  reviewerNotes String?
  createdAt     DateTime @default(now())

  content Content @relation(fields: [contentId], references: [id], onDelete: Cascade)

  @@index([contentId])
}

// ==================== MESSAGING MODELS ====================

model Conversation {
  id            String   @id @default(cuid())
  campaignId    String?
  campaignTitle String?
  lastMessageAt DateTime @default(now())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  participants ConversationParticipant[]
  messages     Message[]

  @@index([lastMessageAt])
}

model ConversationParticipant {
  id             String    @id @default(cuid())
  conversationId String
  userId         String
  unreadCount    Int       @default(0)
  lastReadAt     DateTime?
  joinedAt       DateTime  @default(now())
  leftAt         DateTime?

  conversation Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  user         User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([conversationId, userId])
  @@index([conversationId])
  @@index([userId])
}

model Message {
  id             String        @id @default(cuid())
  conversationId String
  senderId       String
  recipientId    String?
  content        String
  status         MessageStatus @default(SENT)
  readAt         DateTime?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt

  conversation Conversation        @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  sender       User                @relation("SentMessages", fields: [senderId], references: [id])
  recipient    User?               @relation("ReceivedMessages", fields: [recipientId], references: [id])
  attachments  MessageAttachment[]
  reactions    MessageReaction[]

  @@index([conversationId])
  @@index([senderId])
  @@index([recipientId])
  @@index([createdAt])
}

model MessageAttachment {
  id        String   @id @default(cuid())
  messageId String
  type      String
  url       String
  filename  String
  size      Int
  createdAt DateTime @default(now())

  message Message @relation(fields: [messageId], references: [id], onDelete: Cascade)

  @@index([messageId])
}

// ==================== NOTIFICATION MODELS ====================

model Notification {
  id        String           @id @default(cuid())
  userId    String
  type      NotificationType
  title     String
  message   String
  link      String?
  read      Boolean          @default(false)
  readAt    DateTime?
  metadata  Json?
  createdAt DateTime         @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([read])
  @@index([type])
  @@index([createdAt])
}

// ==================== PAYMENT MODELS ====================

model Payment {
  id           String        @id @default(cuid())
  brandId      String
  influencerId String
  campaignId   String?
  amount       Decimal       @db.Decimal(10, 2)
  currency     String        @default("USD")
  status       PaymentStatus @default(PENDING)
  description  String?

  // Payment processor
  stripePaymentId  String?
  stripeTransferId String?

  processedAt   DateTime?
  failedAt      DateTime?
  failureReason String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  brand              Brand               @relation(fields: [brandId], references: [id])
  influencer         Influencer          @relation(fields: [influencerId], references: [id])
  campaign           Campaign?           @relation(fields: [campaignId], references: [id])
  walletTransactions WalletTransaction[]

  @@index([brandId])
  @@index([influencerId])
  @@index([campaignId])
  @@index([status])
  @@index([createdAt])
}

model PaymentMethod {
  id                    String   @id @default(cuid())
  userId                String
  type                  String
  last4                 String
  brand                 String?
  expiryMonth           Int?
  expiryYear            Int?
  isDefault             Boolean  @default(false)
  stripePaymentMethodId String?
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  @@index([userId])
  @@index([isDefault])
}

// ==================== REVIEW MODELS ====================

model InfluencerReview {
  id           String  @id @default(cuid())
  influencerId String
  brandId      String
  campaignId   String?
  rating       Int
  comment      String?
  verified     Boolean @default(true)

  // Phase 1: Detailed ratings
  communicationRating   Int?
  contentQualityRating  Int?
  professionalismRating Int?
  valueForMoneyRating   Int?

  // Delivery metrics (auto-calculated)
  wasOnTime        Boolean?
  deliveryDaysLate Int?

  // Response
  influencerResponse    String?
  influencerRespondedAt DateTime?

  // Visibility & Moderation
  isPublic           Boolean @default(true)
  isVerifiedPurchase Boolean @default(true)
  isReported         Boolean @default(false)
  moderationStatus   String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  influencer Influencer @relation(fields: [influencerId], references: [id], onDelete: Cascade)
  brand      Brand      @relation(fields: [brandId], references: [id])

  @@unique([influencerId, brandId, campaignId])
  @@index([influencerId])
  @@index([brandId])
  @@index([rating])
  @@index([isPublic])
}

model BrandReview {
  id           String  @id @default(cuid())
  brandId      String
  influencerId String
  campaignId   String?
  rating       Int
  comment      String?

  // Phase 1: Detailed ratings
  communicationRating   Int?
  paymentSpeedRating    Int?
  professionalismRating Int?
  briefClarityRating    Int?

  // Response
  brandResponse    String?
  brandRespondedAt DateTime?

  // Visibility & Moderation
  isPublic           Boolean @default(true)
  isVerifiedPurchase Boolean @default(true)
  isReported         Boolean @default(false)
  moderationStatus   String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  brand      Brand      @relation(fields: [brandId], references: [id], onDelete: Cascade)
  influencer Influencer @relation(fields: [influencerId], references: [id])

  @@unique([brandId, influencerId, campaignId])
  @@index([brandId])
  @@index([rating])
  @@index([isPublic])
}

// ==================== INSTAGRAM GRAPH API MODELS ====================

model InstagramProfile {
  id                String  @id @default(cuid())
  influencerId      String  @unique
  instagramUserId   String  @unique
  username          String
  name              String?
  biography         String?
  profilePictureUrl String?
  website           String?
  followersCount    Int     @default(0)
  followsCount      Int     @default(0)
  mediaCount        Int     @default(0)
  accountType       String?

  accessToken    String
  tokenExpiresAt DateTime

  lastSyncedAt DateTime @default(now())
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  influencer       Influencer                 @relation(fields: [influencerId], references: [id], onDelete: Cascade)
  media            InstagramMedia[]
  insights         InstagramInsights[]
  audienceInsights InstagramAudienceInsights?

  @@index([instagramUserId])
  @@index([username])
}

model InstagramMedia {
  id                 String   @id @default(cuid())
  instagramProfileId String
  mediaId            String   @unique
  mediaType          String
  mediaUrl           String?
  thumbnailUrl       String?
  permalink          String?
  caption            String?
  timestamp          DateTime

  likeCount     Int @default(0)
  commentsCount Int @default(0)

  videoViews Int?
  plays      Int?

  reach       Int?
  impressions Int?
  engagement  Int?
  saved       Int?
  shares      Int?

  lastSyncedAt DateTime @default(now())
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  profile InstagramProfile @relation(fields: [instagramProfileId], references: [id], onDelete: Cascade)

  @@index([instagramProfileId])
  @@index([timestamp])
  @@index([mediaType])
}

model InstagramInsights {
  id                 String   @id @default(cuid())
  instagramProfileId String
  period             String
  date               DateTime @db.Date

  impressions         Int?
  reach               Int?
  profileViews        Int?
  websiteClicks       Int?
  emailContacts       Int?
  getDirectionsClicks Int?
  phoneCallClicks     Int?
  textMessageClicks   Int?
  followerCount       Int?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  profile InstagramProfile @relation(fields: [instagramProfileId], references: [id], onDelete: Cascade)

  @@unique([instagramProfileId, period, date])
  @@index([instagramProfileId])
  @@index([date])
}

model InstagramAudienceInsights {
  id                 String @id @default(cuid())
  instagramProfileId String @unique

  audienceGenderAge Json?
  audienceLocale    Json?
  audienceCountry   Json?
  audienceCity      Json?
  onlineFollowers   Json?

  lastSyncedAt DateTime @default(now())
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  profile InstagramProfile @relation(fields: [instagramProfileId], references: [id], onDelete: Cascade)
}

// ==================== PHASE 1: COLLABORATION WORKFLOW ====================

enum CollaborationStatus {
  PROPOSAL_SENT
  PROPOSAL_ACCEPTED
  NEGOTIATING
  CONTRACT_PENDING
  CONTRACT_SIGNED
  IN_PRODUCTION
  CONTENT_SUBMITTED
  REVISION_REQUESTED
  CONTENT_APPROVED
  PUBLISHED
  PAYMENT_PENDING
  COMPLETED
  CANCELLED
  DISPUTED
}

enum MilestoneStatus {
  PENDING
  IN_PROGRESS
  SUBMITTED
  APPROVED
  PAID
}

model Collaboration {
  id           String              @id @default(cuid())
  campaignId   String
  influencerId String
  brandId      String
  status       CollaborationStatus @default(PROPOSAL_SENT)

  // Financial
  agreedAmount     Decimal @db.Decimal(10, 2)
  platformFee      Decimal @db.Decimal(10, 2)
  influencerPayout Decimal @db.Decimal(10, 2)
  currency         String  @default("USD")

  // Timeline
  startDate      DateTime?
  endDate        DateTime?
  contentDueDate DateTime?

  // Tracking
  currentMilestoneId String?

  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  completedAt DateTime?
  cancelledAt DateTime?

  // Relations
  campaign           Campaign                     @relation(fields: [campaignId], references: [id])
  influencer         Influencer                   @relation(fields: [influencerId], references: [id])
  brand              Brand                        @relation(fields: [brandId], references: [id])
  contract           CollaborationContract?
  milestones         Milestone[]
  statusHistory      CollaborationStatusHistory[]
  deliverables       CollaborationDeliverable[]
  communications     CollaborationMessage[]
  escrowAccount      EscrowAccount?
  disputes           Dispute[]
  walletTransactions WalletTransaction[]

  @@index([campaignId])
  @@index([influencerId])
  @@index([brandId])
  @@index([status])
  @@index([createdAt])
}

model CollaborationContract {
  id                String  @id @default(cuid())
  collaborationId   String  @unique
  templateId        String?
  terms             String  @db.Text
  deliverableTerms  Json
  paymentTerms      Json
  cancellationTerms String? @db.Text

  brandSignature String?
  brandSignedAt  DateTime?
  brandSignedIp  String?

  influencerSignature String?
  influencerSignedAt  DateTime?
  influencerSignedIp  String?

  isFullySigned Boolean @default(false)
  pdfUrl        String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  collaboration Collaboration     @relation(fields: [collaborationId], references: [id], onDelete: Cascade)
  template      ContractTemplate? @relation(fields: [templateId], references: [id])

  @@index([isFullySigned])
}

model ContractTemplate {
  id        String   @id @default(cuid())
  brandId   String?
  name      String
  content   String   @db.Text
  variables String[]
  isDefault Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  brand     Brand?                  @relation(fields: [brandId], references: [id])
  contracts CollaborationContract[]

  @@index([brandId])
  @@index([isDefault])
}

model Milestone {
  id              String          @id @default(cuid())
  collaborationId String
  title           String
  description     String?
  order           Int
  amount          Decimal         @db.Decimal(10, 2)
  dueDate         DateTime?
  status          MilestoneStatus @default(PENDING)
  completedAt     DateTime?
  approvedAt      DateTime?
  paidAt          DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  collaboration      Collaboration              @relation(fields: [collaborationId], references: [id], onDelete: Cascade)
  deliverables       CollaborationDeliverable[]
  payment            MilestonePayment?
  escrowRelease      EscrowRelease?
  walletTransactions WalletTransaction[]

  @@index([collaborationId])
  @@index([status])
  @@index([order])
}

model CollaborationDeliverable {
  id              String            @id @default(cuid())
  collaborationId String
  milestoneId     String?
  type            String
  platform        Platform
  description     String?
  quantity        Int               @default(1)
  status          DeliverableStatus @default(PENDING)

  // Submission tracking
  currentVersion Int @default(0)

  dueDate      DateTime?
  submittedAt  DateTime?
  approvedAt   DateTime?
  publishedAt  DateTime?
  publishedUrl String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  collaboration Collaboration        @relation(fields: [collaborationId], references: [id], onDelete: Cascade)
  milestone     Milestone?           @relation(fields: [milestoneId], references: [id])
  versions      DeliverableVersion[]

  @@index([collaborationId])
  @@index([milestoneId])
  @@index([status])
}

model DeliverableVersion {
  id            String @id @default(cuid())
  deliverableId String
  version       Int

  // Content
  mediaUrls String[]
  caption   String?  @db.Text
  notes     String?  @db.Text

  // Review
  reviewedAt   DateTime?
  reviewedBy   String?
  reviewStatus String?
  feedback     String?   @db.Text

  submittedAt DateTime @default(now())

  deliverable CollaborationDeliverable @relation(fields: [deliverableId], references: [id], onDelete: Cascade)

  @@unique([deliverableId, version])
  @@index([deliverableId])
}

model CollaborationStatusHistory {
  id              String               @id @default(cuid())
  collaborationId String
  fromStatus      CollaborationStatus?
  toStatus        CollaborationStatus
  changedBy       String
  reason          String?
  metadata        Json?
  createdAt       DateTime             @default(now())

  collaboration Collaboration @relation(fields: [collaborationId], references: [id], onDelete: Cascade)

  @@index([collaborationId])
  @@index([createdAt])
}

model CollaborationMessage {
  id              String   @id @default(cuid())
  collaborationId String
  senderId        String
  content         String   @db.Text
  attachments     String[]
  isSystemMessage Boolean  @default(false)
  createdAt       DateTime @default(now())

  collaboration Collaboration @relation(fields: [collaborationId], references: [id], onDelete: Cascade)
  sender        User          @relation(fields: [senderId], references: [id])

  @@index([collaborationId])
  @@index([createdAt])
}

// ==================== PHASE 1: PAYMENTS, ESCROW & INVOICING ====================

enum TransactionType {
  DEPOSIT
  WITHDRAWAL
  ESCROW_HOLD
  ESCROW_RELEASE
  PLATFORM_FEE
  REFUND
  PAYOUT
  ADJUSTMENT
}

enum WalletType {
  BRAND_WALLET
  INFLUENCER_WALLET
  PLATFORM_ESCROW
  PLATFORM_REVENUE
}

enum EscrowStatus {
  PENDING
  FUNDED
  PARTIALLY_RELEASED
  FULLY_RELEASED
  REFUNDED
  DISPUTED
}

enum InvoiceType {
  BRAND_DEPOSIT
  INFLUENCER_PAYOUT
  PLATFORM_FEE
  REFUND
}

enum InvoiceStatus {
  DRAFT
  SENT
  PAID
  OVERDUE
  CANCELLED
}

model Wallet {
  id             String     @id @default(cuid())
  userId         String     @unique
  type           WalletType
  balance        Decimal    @default(0) @db.Decimal(12, 2)
  pendingBalance Decimal    @default(0) @db.Decimal(12, 2)
  currency       String     @default("USD")
  isActive       Boolean    @default(true)
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt

  user         User                @relation(fields: [userId], references: [id])
  transactions WalletTransaction[]

  @@index([userId])
  @@index([type])
}

model WalletTransaction {
  id          String          @id @default(cuid())
  walletId    String
  type        TransactionType
  amount      Decimal         @db.Decimal(12, 2)
  balance     Decimal         @db.Decimal(12, 2)
  currency    String          @default("USD")
  description String?

  // References
  relatedTransactionId String?
  collaborationId      String?
  milestoneId          String?
  paymentId            String?
  invoiceId            String?

  // Metadata
  metadata Json?

  createdAt DateTime @default(now())

  wallet        Wallet         @relation(fields: [walletId], references: [id])
  collaboration Collaboration? @relation(fields: [collaborationId], references: [id])
  milestone     Milestone?     @relation(fields: [milestoneId], references: [id])
  payment       Payment?       @relation(fields: [paymentId], references: [id])
  invoice       Invoice?       @relation(fields: [invoiceId], references: [id])

  @@index([walletId])
  @@index([type])
  @@index([collaborationId])
  @@index([createdAt])
}

model EscrowAccount {
  id              String       @id @default(cuid())
  collaborationId String       @unique
  brandId         String
  influencerId    String
  totalAmount     Decimal      @db.Decimal(12, 2)
  heldAmount      Decimal      @default(0) @db.Decimal(12, 2)
  releasedAmount  Decimal      @default(0) @db.Decimal(12, 2)
  platformFee     Decimal      @db.Decimal(12, 2)
  currency        String       @default("USD")
  status          EscrowStatus @default(PENDING)

  fundedAt   DateTime?
  releasedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  collaboration Collaboration   @relation(fields: [collaborationId], references: [id])
  brand         Brand           @relation(fields: [brandId], references: [id])
  influencer    Influencer      @relation(fields: [influencerId], references: [id])
  releases      EscrowRelease[]

  @@index([brandId])
  @@index([influencerId])
  @@index([status])
}

model EscrowRelease {
  id              String   @id @default(cuid())
  escrowAccountId String
  milestoneId     String?  @unique
  amount          Decimal  @db.Decimal(12, 2)
  platformFee     Decimal  @db.Decimal(12, 2)
  netAmount       Decimal  @db.Decimal(12, 2)
  reason          String?
  approvedBy      String
  releasedAt      DateTime @default(now())

  escrowAccount EscrowAccount @relation(fields: [escrowAccountId], references: [id])
  milestone     Milestone?    @relation(fields: [milestoneId], references: [id])

  @@index([escrowAccountId])
}

model MilestonePayment {
  id          String        @id @default(cuid())
  milestoneId String        @unique
  amount      Decimal       @db.Decimal(12, 2)
  platformFee Decimal       @db.Decimal(12, 2)
  netAmount   Decimal       @db.Decimal(12, 2)
  status      PaymentStatus @default(PENDING)

  paidAt           DateTime?
  stripeTransferId String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  milestone Milestone @relation(fields: [milestoneId], references: [id])

  @@index([status])
}

model Invoice {
  id              String  @id @default(cuid())
  invoiceNumber   String  @unique
  brandId         String?
  influencerId    String?
  collaborationId String?

  type   InvoiceType
  status InvoiceStatus @default(DRAFT)

  // Line items
  lineItems Json

  // Totals
  subtotal    Decimal  @db.Decimal(12, 2)
  taxRate     Decimal? @db.Decimal(5, 2)
  taxAmount   Decimal? @db.Decimal(12, 2)
  platformFee Decimal? @db.Decimal(12, 2)
  total       Decimal  @db.Decimal(12, 2)
  currency    String   @default("USD")

  // Tax details
  gstNumber String?
  taxType   String?

  // Dates
  issueDate DateTime  @default(now())
  dueDate   DateTime?
  paidAt    DateTime?

  // Files
  pdfUrl String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  brand        Brand?              @relation(fields: [brandId], references: [id])
  influencer   Influencer?         @relation(fields: [influencerId], references: [id])
  transactions WalletTransaction[]

  @@index([brandId])
  @@index([influencerId])
  @@index([status])
  @@index([issueDate])
  @@index([invoiceNumber])
}

model PayoutMethod {
  id         String  @id @default(cuid())
  userId     String
  type       String
  isDefault  Boolean @default(false)
  isVerified Boolean @default(false)

  // Bank details (last 4 digits only for display)
  bankName           String?
  accountNumberLast4 String?
  routingNumber      String?
  accountHolderName  String?

  // External accounts
  stripeConnectId String?
  paypalEmail     String?

  // For international
  swiftCode String?
  iban      String?
  country   String?
  currency  String  @default("USD")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isDefault])
}

model PlatformCommission {
  id         String   @id @default(cuid())
  name       String
  percentage Decimal  @db.Decimal(5, 2)
  minAmount  Decimal? @db.Decimal(12, 2)
  maxAmount  Decimal? @db.Decimal(12, 2)
  tierMin    Decimal? @db.Decimal(12, 2)
  tierMax    Decimal? @db.Decimal(12, 2)
  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([isActive])
}

// ==================== PHASE 1: REPUTATION & TRUST SYSTEM ====================

enum VerificationBadge {
  IDENTITY_VERIFIED
  BUSINESS_VERIFIED
  TOP_CREATOR
  RISING_STAR
  RELIABLE_PAYER
  FAST_RESPONDER
  QUALITY_CONTENT
}

model ReputationScore {
  id       String   @id @default(cuid())
  userId   String   @unique
  userType UserRole

  // Overall scores
  overallScore Decimal @db.Decimal(3, 2)
  totalReviews Int     @default(0)

  // Component scores (for influencers)
  onTimeDeliveryScore  Decimal? @db.Decimal(5, 2)
  contentQualityScore  Decimal? @db.Decimal(3, 2)
  communicationScore   Decimal? @db.Decimal(3, 2)
  professionalismScore Decimal? @db.Decimal(3, 2)

  // Component scores (for brands)
  paymentReliabilityScore Decimal? @db.Decimal(5, 2)
  briefClarityScore       Decimal? @db.Decimal(3, 2)

  // Badges
  badges VerificationBadge[]

  // History
  scoreHistory Json?

  lastCalculatedAt DateTime @default(now())
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([overallScore])
  @@index([userType])
}

model VerificationRequest {
  id               String @id @default(cuid())
  userId           String
  verificationType String
  status           String @default("PENDING")

  // Documents
  documents String[]

  // Review
  reviewedBy      String?
  reviewedAt      DateTime?
  rejectionReason String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([status])
  @@index([verificationType])
}

model Dispute {
  id              String @id @default(cuid())
  collaborationId String
  raisedBy        String
  againstUserId   String

  type        String
  description String   @db.Text
  evidence    String[]

  status     String    @default("OPEN")
  resolution String?
  resolvedAt DateTime?
  resolvedBy String?

  // Impact on reputation
  impactsReputation Boolean @default(false)
  reputationAction  String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  collaboration Collaboration @relation(fields: [collaborationId], references: [id])
  raiser        User          @relation("DisputeRaiser", fields: [raisedBy], references: [id])
  against       User          @relation("DisputeAgainst", fields: [againstUserId], references: [id])

  @@index([collaborationId])
  @@index([status])
  @@index([raisedBy])
  @@index([againstUserId])
}

// ==================== PHASE 2: SOCIAL FEED LAYER ====================

enum FeedPostType {
  TEXT
  IMAGE
  VIDEO
  CAROUSEL
  POLL
  CAMPAIGN_SHARE
  MILESTONE_ACHIEVEMENT
  PORTFOLIO_PIECE
}

enum FeedPostVisibility {
  PUBLIC
  FOLLOWERS_ONLY
  CONNECTIONS_ONLY
  PRIVATE
}

model FeedPost {
  id         String             @id @default(cuid())
  authorId   String
  type       FeedPostType
  visibility FeedPostVisibility @default(PUBLIC)

  // Content
  content    String   @db.Text
  mediaUrls  String[]
  thumbnails String[]

  // Campaign reference (for campaign shares)
  campaignId String?

  // Engagement metrics (denormalized for performance)
  likesCount    Int @default(0)
  commentsCount Int @default(0)
  sharesCount   Int @default(0)
  viewsCount    Int @default(0)

  // Metadata
  hashtags  String[]
  mentions  String[]
  isPinned  Boolean  @default(false)
  isDeleted Boolean  @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  author   User          @relation(fields: [authorId], references: [id], onDelete: Cascade)
  campaign Campaign?     @relation(fields: [campaignId], references: [id])
  likes    FeedLike[]
  comments FeedComment[]
  shares   FeedShare[]
  poll     FeedPoll?

  @@index([authorId])
  @@index([type])
  @@index([visibility])
  @@index([createdAt])
  @@index([campaignId])
}

model FeedLike {
  id     String @id @default(cuid())
  postId String
  userId String

  createdAt DateTime @default(now())

  post FeedPost @relation(fields: [postId], references: [id], onDelete: Cascade)
  user User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([postId, userId])
  @@index([postId])
  @@index([userId])
}

model FeedComment {
  id         String  @id @default(cuid())
  postId     String
  authorId   String
  parentId   String?
  content    String  @db.Text
  likesCount Int     @default(0)

  isDeleted Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  post    FeedPost      @relation(fields: [postId], references: [id], onDelete: Cascade)
  author  User          @relation(fields: [authorId], references: [id], onDelete: Cascade)
  parent  FeedComment?  @relation("CommentReplies", fields: [parentId], references: [id])
  replies FeedComment[] @relation("CommentReplies")

  @@index([postId])
  @@index([authorId])
  @@index([parentId])
}

model FeedShare {
  id     String  @id @default(cuid())
  postId String
  userId String
  note   String?

  createdAt DateTime @default(now())

  post FeedPost @relation(fields: [postId], references: [id], onDelete: Cascade)
  user User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([postId])
  @@index([userId])
}

model FeedPoll {
  id     String @id @default(cuid())
  postId String @unique

  question String
  options  Json
  endsAt   DateTime?

  createdAt DateTime @default(now())

  post  FeedPost       @relation(fields: [postId], references: [id], onDelete: Cascade)
  votes FeedPollVote[]
}

model FeedPollVote {
  id          String @id @default(cuid())
  pollId      String
  userId      String
  optionIndex Int

  createdAt DateTime @default(now())

  poll FeedPoll @relation(fields: [pollId], references: [id], onDelete: Cascade)
  user User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([pollId, userId])
  @@index([pollId])
}

model UserFollow {
  id          String @id @default(cuid())
  followerId  String
  followingId String

  createdAt DateTime @default(now())

  follower  User @relation("Following", fields: [followerId], references: [id], onDelete: Cascade)
  following User @relation("Followers", fields: [followingId], references: [id], onDelete: Cascade)

  @@unique([followerId, followingId])
  @@index([followerId])
  @@index([followingId])
}

// ==================== PHASE 2: INFLUENCER CRM ====================

enum CRMContactStatus {
  LEAD
  CONTACTED
  IN_DISCUSSION
  ACTIVE_PARTNER
  PAST_PARTNER
  BLACKLISTED
}

model CRMContact {
  id           String @id @default(cuid())
  brandId      String
  influencerId String

  status       CRMContactStatus @default(LEAD)
  customLabels String[]

  // Engagement tracking
  lastContactedAt     DateTime?
  nextFollowUpAt      DateTime?
  totalCollaborations Int       @default(0)
  totalSpend          Decimal   @default(0) @db.Decimal(12, 2)

  // Notes & metadata
  internalNotes String? @db.Text
  customFields  Json?

  // Source tracking
  source     String?
  acquiredAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  brand      Brand         @relation(fields: [brandId], references: [id], onDelete: Cascade)
  influencer Influencer    @relation(fields: [influencerId], references: [id])
  notes      CRMNote[]
  activities CRMActivity[]

  @@unique([brandId, influencerId])
  @@index([brandId])
  @@index([influencerId])
  @@index([status])
}

model CRMNote {
  id        String  @id @default(cuid())
  contactId String
  authorId  String
  content   String  @db.Text
  isPinned  Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  contact CRMContact @relation(fields: [contactId], references: [id], onDelete: Cascade)

  @@index([contactId])
}

model CRMActivity {
  id        String  @id @default(cuid())
  contactId String
  type      String
  title     String
  details   String? @db.Text

  // Reference to related entity
  referenceId   String?
  referenceType String?

  createdAt DateTime @default(now())

  contact CRMContact @relation(fields: [contactId], references: [id], onDelete: Cascade)

  @@index([contactId])
  @@index([type])
  @@index([createdAt])
}

model CRMList {
  id          String  @id @default(cuid())
  brandId     String
  name        String
  description String?

  // Smart list criteria
  isSmartList Boolean @default(false)
  criteria    Json?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  brand   Brand           @relation(fields: [brandId], references: [id], onDelete: Cascade)
  members CRMListMember[]

  @@index([brandId])
}

model CRMListMember {
  id        String   @id @default(cuid())
  listId    String
  contactId String
  addedAt   DateTime @default(now())

  list CRMList @relation(fields: [listId], references: [id], onDelete: Cascade)

  @@unique([listId, contactId])
  @@index([listId])
}

// ==================== PHASE 2: OPEN CAMPAIGN MARKETPLACE ====================

enum MarketplaceListingStatus {
  DRAFT
  ACTIVE
  PAUSED
  CLOSED
  FILLED
}

model MarketplaceListing {
  id         String @id @default(cuid())
  campaignId String
  brandId    String

  status       MarketplaceListingStatus @default(DRAFT)
  title        String
  description  String                   @db.Text
  requirements String?                  @db.Text

  // Budget
  budgetMin        Decimal?         @db.Decimal(12, 2)
  budgetMax        Decimal?         @db.Decimal(12, 2)
  compensationType CompensationType

  // Targeting
  targetNiches    String[]
  targetPlatforms String[]
  minFollowers    Int?
  maxFollowers    Int?
  targetLocations String[]
  targetAgeRange  String?
  targetGender    String?

  // Slots
  totalSlots     Int @default(1)
  filledSlots    Int @default(0)
  applicantCount Int @default(0)

  // Dates
  applicationDeadline DateTime?
  campaignStartDate   DateTime?
  campaignEndDate     DateTime?

  // Visibility
  isFeatured Boolean @default(false)
  isPremium  Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  campaign     Campaign                 @relation(fields: [campaignId], references: [id])
  brand        Brand                    @relation(fields: [brandId], references: [id])
  applications MarketplaceApplication[]

  @@index([status])
  @@index([brandId])
  @@index([campaignId])
  @@index([createdAt])
  @@index([isFeatured])
  @@index([compensationType])
}

model MarketplaceApplication {
  id           String            @id @default(cuid())
  listingId    String
  influencerId String
  status       ApplicationStatus @default(PENDING)

  // Proposal
  coverLetter  String?  @db.Text
  proposedRate Decimal? @db.Decimal(12, 2)
  portfolio    String[]
  availability String?

  // Review
  reviewedAt  DateTime?
  reviewNotes String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  listing    MarketplaceListing @relation(fields: [listingId], references: [id], onDelete: Cascade)
  influencer Influencer         @relation(fields: [influencerId], references: [id])

  @@unique([listingId, influencerId])
  @@index([listingId])
  @@index([influencerId])
  @@index([status])
}

// ==================== PHASE 2: ANALYTICS & INTELLIGENCE ====================

model AnalyticsSnapshot {
  id         String   @id @default(cuid())
  entityId   String
  entityType String
  period     String
  periodDate DateTime

  // Core metrics
  metrics Json

  // Computed scores
  engagementRate Decimal? @db.Decimal(8, 4)
  growthRate     Decimal? @db.Decimal(8, 4)
  sentimentScore Decimal? @db.Decimal(3, 2)

  createdAt DateTime @default(now())

  @@unique([entityId, entityType, period, periodDate])
  @@index([entityId, entityType])
  @@index([periodDate])
  @@index([period])
}

model CampaignAnalytics {
  id         String @id @default(cuid())
  campaignId String @unique

  // Performance
  totalReach       Int @default(0)
  totalImpressions Int @default(0)
  totalEngagement  Int @default(0)
  totalClicks      Int @default(0)
  totalConversions Int @default(0)

  // Financial
  totalSpend        Decimal  @default(0) @db.Decimal(12, 2)
  costPerClick      Decimal? @db.Decimal(8, 4)
  costPerEngagement Decimal? @db.Decimal(8, 4)
  costPerConversion Decimal? @db.Decimal(8, 4)
  roi               Decimal? @db.Decimal(8, 4)

  // Content
  totalPosts        Int      @default(0)
  avgEngagementRate Decimal? @db.Decimal(8, 4)

  // Audience
  audienceReached    Int @default(0)
  newFollowersGained Int @default(0)

  // Timeline data
  dailyMetrics Json?

  lastUpdatedAt DateTime @default(now())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  campaign Campaign @relation(fields: [campaignId], references: [id])

  @@index([campaignId])
}

model InfluencerAnalytics {
  id           String @id @default(cuid())
  influencerId String @unique

  // Platform aggregated metrics
  totalFollowers    Int      @default(0)
  totalEngagement   Int      @default(0)
  avgEngagementRate Decimal? @db.Decimal(8, 4)

  // Performance
  completedCampaigns Int      @default(0)
  averageRating      Decimal? @db.Decimal(3, 2)
  onTimeDeliveryRate Decimal? @db.Decimal(5, 2)

  // Content metrics
  totalPostsCreated Int @default(0)
  avgPostReach      Int @default(0)

  // Growth
  followerGrowthRate Decimal? @db.Decimal(8, 4)
  engagementTrend    String?

  // Audience demographics
  audienceGender    Json?
  audienceAge       Json?
  audienceLocations Json?
  audienceInterests Json?

  lastUpdatedAt DateTime @default(now())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  influencer Influencer @relation(fields: [influencerId], references: [id])

  @@index([influencerId])
}

model PlatformAnalytics {
  id     String   @id @default(cuid())
  date   DateTime @unique
  period String   @default("DAILY")

  // User metrics
  totalUsers       Int @default(0)
  newUsers         Int @default(0)
  activeUsers      Int @default(0)
  totalBrands      Int @default(0)
  totalInfluencers Int @default(0)

  // Campaign metrics
  activeCampaigns    Int     @default(0)
  completedCampaigns Int     @default(0)
  totalCampaignSpend Decimal @default(0) @db.Decimal(14, 2)

  // Transaction metrics
  totalTransactions  Int     @default(0)
  totalRevenue       Decimal @default(0) @db.Decimal(14, 2)
  platformFeeRevenue Decimal @default(0) @db.Decimal(14, 2)

  // Engagement metrics
  totalCollaborations    Int      @default(0)
  avgCollaborationRating Decimal? @db.Decimal(3, 2)

  createdAt DateTime @default(now())

  @@index([date])
  @@index([period])
}

// ==================== PHASE 3: AI INTELLIGENCE LAYER ====================

model AIMatchScore {
  id           String  @id @default(cuid())
  brandId      String
  influencerId String
  campaignId   String?

  // Match scores (0-100)
  overallScore     Decimal @db.Decimal(5, 2)
  audienceScore    Decimal @db.Decimal(5, 2)
  contentScore     Decimal @db.Decimal(5, 2)
  engagementScore  Decimal @db.Decimal(5, 2)
  budgetFitScore   Decimal @db.Decimal(5, 2)
  brandSafetyScore Decimal @db.Decimal(5, 2)

  // Reasoning
  matchReasons   String[]
  warnings       String[]
  recommendation String?

  // Metadata
  modelVersion String
  computedAt   DateTime @default(now())

  brand      Brand      @relation(fields: [brandId], references: [id])
  influencer Influencer @relation(fields: [influencerId], references: [id])
  campaign   Campaign?  @relation(fields: [campaignId], references: [id])

  @@unique([brandId, influencerId, campaignId])
  @@index([brandId])
  @@index([influencerId])
  @@index([overallScore])
}

model AIContentSuggestion {
  id           String  @id @default(cuid())
  campaignId   String
  influencerId String?

  // Content
  type              String
  title             String
  description       String   @db.Text
  suggestedHooks    String[]
  suggestedHashtags String[]
  toneGuidance      String?
  formatTips        String?

  // Performance prediction
  predictedEngagementRate Decimal? @db.Decimal(5, 2)
  predictedReach          Int?
  confidenceScore         Decimal? @db.Decimal(3, 2)

  // Status
  status   String  @default("PENDING")
  feedback String?

  modelVersion String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  campaign Campaign @relation(fields: [campaignId], references: [id])

  @@index([campaignId])
  @@index([status])
}

model AIPricingRecommendation {
  id           String @id @default(cuid())
  influencerId String
  platform     String
  contentType  String

  recommendedPrice Decimal @db.Decimal(12, 2)
  priceRangeMin    Decimal @db.Decimal(12, 2)
  priceRangeMax    Decimal @db.Decimal(12, 2)

  // Factors
  factors Json

  modelVersion String
  createdAt    DateTime @default(now())

  influencer Influencer @relation(fields: [influencerId], references: [id])

  @@index([influencerId])
  @@index([platform, contentType])
}

model AIFraudFlag {
  id           String    @id @default(cuid())
  influencerId String
  type         String
  severity     String
  description  String    @db.Text
  evidence     Json
  status       String    @default("PENDING")
  resolvedBy   String?
  resolvedAt   DateTime?

  modelVersion String
  createdAt    DateTime @default(now())

  influencer Influencer @relation(fields: [influencerId], references: [id])

  @@index([influencerId])
  @@index([type])
  @@index([status])
}

// ==================== PHASE 3: MONETIZATION & SUBSCRIPTION ENGINE ====================

enum SubscriptionTier {
  FREE
  STARTER
  PROFESSIONAL
  ENTERPRISE
}

enum SubscriptionStatus {
  ACTIVE
  PAST_DUE
  CANCELLED
  PAUSED
  TRIALING
}

enum BillingInterval {
  MONTHLY
  YEARLY
}

model SubscriptionPlan {
  id          String           @id @default(cuid())
  name        String
  tier        SubscriptionTier @unique
  description String?

  // Pricing
  monthlyPrice Decimal @db.Decimal(10, 2)
  yearlyPrice  Decimal @db.Decimal(10, 2)
  currency     String  @default("USD")

  // Limits
  maxCampaigns   Int?
  maxInfluencers Int?
  maxTeamMembers Int?
  maxListings    Int?
  maxAIQueries   Int?
  storageLimit   Int?

  // Features
  features String[]

  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  subscriptions Subscription[]

  @@index([tier])
  @@index([isActive])
}

model Subscription {
  id     String             @id @default(cuid())
  userId String
  planId String
  status SubscriptionStatus @default(ACTIVE)

  // Billing
  billingInterval    BillingInterval
  currentPeriodStart DateTime
  currentPeriodEnd   DateTime
  cancelAt           DateTime?
  cancelledAt        DateTime?

  // Payment
  stripeSubscriptionId String? @unique
  stripeCustomerId     String?

  // Trial
  trialStart DateTime?
  trialEnd   DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user     User                  @relation(fields: [userId], references: [id])
  plan     SubscriptionPlan      @relation(fields: [planId], references: [id])
  invoices SubscriptionInvoice[]

  @@index([userId])
  @@index([status])
  @@index([stripeSubscriptionId])
}

model SubscriptionInvoice {
  id              String    @id @default(cuid())
  subscriptionId  String
  amount          Decimal   @db.Decimal(10, 2)
  currency        String    @default("USD")
  status          String    @default("PENDING")
  stripeInvoiceId String?
  paidAt          DateTime?
  dueDate         DateTime

  createdAt DateTime @default(now())

  subscription Subscription @relation(fields: [subscriptionId], references: [id])

  @@index([subscriptionId])
  @@index([status])
}

model UsageRecord {
  id     String   @id @default(cuid())
  userId String
  type   String
  count  Int      @default(1)
  period DateTime @db.Date

  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id])

  @@unique([userId, type, period])
  @@index([userId])
  @@index([type])
  @@index([period])
}

model FeatureGate {
  id          String  @id @default(cuid())
  feature     String  @unique
  description String?

  // Tier requirements
  minTier    SubscriptionTier
  isAddon    Boolean          @default(false)
  addonPrice Decimal?         @db.Decimal(10, 2)

  isActive Boolean @default(true)

  @@index([feature])
  @@index([minTier])
}

// ==================== PHASE 4: PLATFORM COMPLETENESS ====================

// ---------- Module 1: Real-time Messaging Enhancement ----------

model MessageReaction {
  id        String   @id @default(cuid())
  messageId String
  userId    String
  emoji     String
  createdAt DateTime @default(now())

  message Message @relation(fields: [messageId], references: [id], onDelete: Cascade)
  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([messageId, userId, emoji])
  @@index([messageId])
  @@index([userId])
}

// ---------- Module 2: Content Approval Workflow ----------

enum ApprovalStatus {
  DRAFT
  SUBMITTED
  IN_REVIEW
  CHANGES_REQUESTED
  APPROVED
  REJECTED
  PUBLISHED
}

model ContentApprovalStep {
  id         String         @id @default(cuid())
  contentId  String
  stepOrder  Int
  reviewerId String
  status     ApprovalStatus @default(DRAFT)
  feedback   String?
  approvedAt DateTime?
  createdAt  DateTime       @default(now())

  content  Content @relation(fields: [contentId], references: [id], onDelete: Cascade)
  reviewer User    @relation(fields: [reviewerId], references: [id])

  @@index([contentId])
  @@index([reviewerId])
  @@index([status])
}

// ---------- Module 3: Advanced Influencer Discovery ----------

model InfluencerComparison {
  id            String   @id @default(cuid())
  brandId       String
  influencerIds String[]
  name          String?
  createdAt     DateTime @default(now())

  brand Brand @relation(fields: [brandId], references: [id], onDelete: Cascade)

  @@index([brandId])
}

model SearchHistory {
  id          String   @id @default(cuid())
  userId      String
  query       String
  filters     Json
  resultCount Int      @default(0)
  createdAt   DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([createdAt])
}

// ---------- Module 4: Affiliate & Link Tracking ----------

model TrackingLink {
  id              String   @id @default(cuid())
  collaborationId String?
  campaignId      String?
  influencerId    String
  originalUrl     String
  shortCode       String   @unique
  utmSource       String?
  utmMedium       String?
  utmCampaign     String?
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())

  influencer  Influencer             @relation(fields: [influencerId], references: [id])
  clicks      TrackingLinkClick[]
  conversions TrackingLinkConversion[]

  @@index([influencerId])
  @@index([shortCode])
  @@index([campaignId])
}

model PromoCode {
  id            String    @id @default(cuid())
  campaignId    String?
  influencerId  String
  code          String    @unique
  discountType  String // PERCENTAGE, FIXED
  discountValue Decimal   @db.Decimal(10, 2)
  maxUses       Int?
  usedCount     Int       @default(0)
  expiresAt     DateTime?
  isActive      Boolean   @default(true)
  createdAt     DateTime  @default(now())

  influencer Influencer @relation(fields: [influencerId], references: [id])

  @@index([influencerId])
  @@index([code])
}

model TrackingLinkClick {
  id        String   @id @default(cuid())
  linkId    String
  ipHash    String
  userAgent String?
  referrer  String?
  country   String?
  device    String?
  createdAt DateTime @default(now())

  link TrackingLink @relation(fields: [linkId], references: [id], onDelete: Cascade)

  @@index([linkId])
  @@index([createdAt])
}

model TrackingLinkConversion {
  id          String   @id @default(cuid())
  linkId      String
  promoCodeId String?
  orderValue  Decimal? @db.Decimal(10, 2)
  commission  Decimal? @db.Decimal(10, 2)
  metadata    Json?
  createdAt   DateTime @default(now())

  link TrackingLink @relation(fields: [linkId], references: [id], onDelete: Cascade)

  @@index([linkId])
  @@index([createdAt])
}

// ---------- Module 5: Contract & Legal Management ----------

model ContractSignatureAudit {
  id         String   @id @default(cuid())
  contractId String
  signerId   String
  signerRole String
  ipAddress  String
  userAgent  String
  signedAt   DateTime @default(now())

  @@index([contractId])
  @@index([signerId])
}

model FTCComplianceCheck {
  id             String   @id @default(cuid())
  contentId      String
  hasDisclosure  Boolean
  disclosureType String?
  isCompliant    Boolean
  issues         String[]
  checkedAt      DateTime @default(now())

  content Content @relation(fields: [contentId], references: [id], onDelete: Cascade)

  @@index([contentId])
  @@index([isCompliant])
}

// ---------- Module 6: Creator Media Kit ----------

model MediaKit {
  id            String   @id @default(cuid())
  influencerId  String   @unique
  bio           String?
  headline      String?
  brandColors   String[]
  coverImageUrl String?
  isPublic      Boolean  @default(true)
  customSlug    String?  @unique
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  influencer Influencer       @relation(fields: [influencerId], references: [id], onDelete: Cascade)
  sections   MediaKitSection[]
  rateCards  RateCard[]

  @@index([customSlug])
}

model MediaKitSection {
  id         String  @id @default(cuid())
  mediaKitId String
  type       String // STATS, PORTFOLIO, TESTIMONIALS, BRANDS_WORKED_WITH, AUDIENCE
  title      String
  content    Json
  order      Int
  isVisible  Boolean @default(true)

  mediaKit MediaKit @relation(fields: [mediaKitId], references: [id], onDelete: Cascade)

  @@index([mediaKitId])
}

model RateCard {
  id           String  @id @default(cuid())
  mediaKitId   String
  platform     String
  contentType  String // Post, Story, Reel, Video
  price        Decimal @db.Decimal(10, 2)
  description  String?
  deliveryDays Int?

  mediaKit MediaKit @relation(fields: [mediaKitId], references: [id], onDelete: Cascade)

  @@index([mediaKitId])
}

// ---------- Module 7: Product Seeding & Gifting ----------

enum GiftingStatus {
  GIFTING_PENDING
  GIFTING_APPROVED
  GIFTING_SHIPPED
  GIFTING_DELIVERED
  GIFTING_CONTENT_RECEIVED
  GIFTING_COMPLETED
  GIFTING_CANCELLED
}

model ProductCatalog {
  id          String   @id @default(cuid())
  brandId     String
  name        String
  description String?
  imageUrl    String?
  value       Decimal  @db.Decimal(10, 2)
  category    String?
  sku         String?
  inStock     Boolean  @default(true)
  createdAt   DateTime @default(now())

  brand         Brand          @relation(fields: [brandId], references: [id], onDelete: Cascade)
  giftingOrders GiftingOrder[]

  @@index([brandId])
  @@index([category])
}

model GiftingOrder {
  id                  String        @id @default(cuid())
  productId           String
  influencerId        String
  brandId             String
  status              GiftingStatus @default(GIFTING_PENDING)
  shippingAddress     Json?
  trackingNumber      String?
  expectedContentDate DateTime?
  notes               String?
  createdAt           DateTime      @default(now())
  updatedAt           DateTime      @updatedAt

  product    ProductCatalog @relation(fields: [productId], references: [id])
  influencer Influencer     @relation(fields: [influencerId], references: [id])
  brand      Brand          @relation(fields: [brandId], references: [id])

  @@index([brandId])
  @@index([influencerId])
  @@index([status])
}

// ---------- Module 8: Team Collaboration & Permissions ----------

enum TeamRole {
  OWNER
  TEAM_ADMIN
  MANAGER
  MEMBER
  VIEWER
}

model Organization {
  id        String   @id @default(cuid())
  name      String
  brandId   String   @unique
  createdAt DateTime @default(now())

  brand   Brand        @relation(fields: [brandId], references: [id], onDelete: Cascade)
  members TeamMember[]
  invites TeamInvite[]
  logs    TeamActivityLog[]

  @@index([brandId])
}

model TeamMember {
  id             String   @id @default(cuid())
  organizationId String
  userId         String
  role           TeamRole @default(MEMBER)
  permissions    String[]
  joinedAt       DateTime @default(now())

  organization Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  user         User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([organizationId, userId])
  @@index([organizationId])
  @@index([userId])
}

model TeamInvite {
  id             String    @id @default(cuid())
  organizationId String
  email          String
  role           TeamRole  @default(MEMBER)
  token          String    @unique
  expiresAt      DateTime
  acceptedAt     DateTime?
  createdAt      DateTime  @default(now())

  organization Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([organizationId])
  @@index([token])
}

model TeamActivityLog {
  id             String   @id @default(cuid())
  organizationId String
  userId         String
  action         String
  entityType     String?
  entityId       String?
  metadata       Json?
  createdAt      DateTime @default(now())

  organization Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([organizationId])
  @@index([createdAt])
}

// ---------- Module 9: Campaign Reporting & Export ----------

model ReportTemplate {
  id        String   @id @default(cuid())
  brandId   String
  name      String
  sections  String[]
  format    String   @default("PDF")
  createdAt DateTime @default(now())

  brand Brand @relation(fields: [brandId], references: [id], onDelete: Cascade)

  @@index([brandId])
}

model GeneratedReport {
  id          String   @id @default(cuid())
  templateId  String?
  brandId     String
  campaignId  String?
  reportType  String // CAMPAIGN, INFLUENCER, PLATFORM, CUSTOM
  dateRange   Json
  data        Json
  fileUrl     String?
  generatedAt DateTime @default(now())

  brand Brand @relation(fields: [brandId], references: [id], onDelete: Cascade)

  @@index([brandId])
  @@index([reportType])
}

model ScheduledReport {
  id         String   @id @default(cuid())
  templateId String
  brandId    String
  frequency  String // DAILY, WEEKLY, MONTHLY
  recipients String[]
  nextRunAt  DateTime
  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now())

  @@index([brandId])
  @@index([isActive])
}

// ---------- Module 10: Influencer Outreach ----------

model OutreachTemplate {
  id        String   @id @default(cuid())
  brandId   String
  name      String
  subject   String
  body      String
  type      String   @default("EMAIL")
  createdAt DateTime @default(now())

  brand Brand @relation(fields: [brandId], references: [id], onDelete: Cascade)

  @@index([brandId])
}

model OutreachCampaign {
  id         String   @id @default(cuid())
  brandId    String
  templateId String
  name       String
  status     String   @default("DRAFT")
  createdAt  DateTime @default(now())

  brand  Brand           @relation(fields: [brandId], references: [id], onDelete: Cascade)
  emails OutreachEmail[]

  @@index([brandId])
  @@index([status])
}

model OutreachEmail {
  id           String    @id @default(cuid())
  campaignId   String
  influencerId String
  email        String
  status       String    @default("PENDING")
  sentAt       DateTime?
  openedAt     DateTime?
  repliedAt    DateTime?

  campaign OutreachCampaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)

  @@index([campaignId])
  @@index([status])
}

// ---------- Module 11: Social Listening ----------

model BrandMention {
  id           String   @id @default(cuid())
  brandId      String
  platform     String
  authorName   String
  authorHandle String?
  content      String
  url          String?
  sentiment    String? // POSITIVE, NEUTRAL, NEGATIVE
  reach        Int?
  engagement   Int?
  detectedAt   DateTime @default(now())

  brand Brand @relation(fields: [brandId], references: [id], onDelete: Cascade)

  @@index([brandId])
  @@index([sentiment])
  @@index([detectedAt])
}

model KeywordTracker {
  id        String   @id @default(cuid())
  brandId   String
  keyword   String
  platforms String[]
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())

  brand Brand @relation(fields: [brandId], references: [id], onDelete: Cascade)

  @@index([brandId])
  @@index([isActive])
}

model SentimentReport {
  id          String   @id @default(cuid())
  brandId     String
  period      String
  periodStart DateTime
  positive    Int      @default(0)
  neutral     Int      @default(0)
  negative    Int      @default(0)
  topMentions Json
  createdAt   DateTime @default(now())

  brand Brand @relation(fields: [brandId], references: [id], onDelete: Cascade)

  @@index([brandId])
  @@index([periodStart])
}

// ---------- Module 12: Integration Hub ----------

model ConnectedApp {
  id           String    @id @default(cuid())
  userId       String
  appName      String
  accessToken  String
  refreshToken String?
  expiresAt    DateTime?
  config       Json?
  isActive     Boolean   @default(true)
  connectedAt  DateTime  @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([appName])
}

model Webhook {
  id         String   @id @default(cuid())
  userId     String
  url        String
  events     String[]
  secret     String
  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now())

  user       User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  deliveries WebhookDelivery[]

  @@index([userId])
  @@index([isActive])
}

model WebhookDelivery {
  id          String   @id @default(cuid())
  webhookId   String
  event       String
  payload     Json
  statusCode  Int?
  response    String?
  deliveredAt DateTime @default(now())

  webhook Webhook @relation(fields: [webhookId], references: [id], onDelete: Cascade)

  @@index([webhookId])
  @@index([deliveredAt])
}

model APIKey {
  id         String    @id @default(cuid())
  userId     String
  name       String
  keyHash    String    @unique
  prefix     String
  scopes     String[]
  lastUsedAt DateTime?
  expiresAt  DateTime?
  createdAt  DateTime  @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([keyHash])
}

// ---------- Module 13: ROI & Budget Calculator ----------

model BudgetPlan {
  id          String   @id @default(cuid())
  brandId     String
  campaignId  String?
  name        String
  totalBudget Decimal  @db.Decimal(12, 2)
  allocations Json
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  brand Brand @relation(fields: [brandId], references: [id], onDelete: Cascade)

  @@index([brandId])
}

model ROIProjection {
  id                   String   @id @default(cuid())
  brandId              String
  campaignId           String?
  budget               Decimal  @db.Decimal(12, 2)
  estimatedReach       Int
  estimatedEngagement  Int
  estimatedConversions Int
  estimatedROI         Decimal  @db.Decimal(8, 2)
  assumptions          Json
  createdAt            DateTime @default(now())

  brand Brand @relation(fields: [brandId], references: [id], onDelete: Cascade)

  @@index([brandId])
}

// ---------- Module 14: UGC Content Library ----------

model UGCContent {
  id              String   @id @default(cuid())
  brandId         String
  influencerId    String?
  collaborationId String?
  title           String?
  mediaUrl        String
  mediaType       String // IMAGE, VIDEO, STORY, REEL
  platform        String?
  tags            String[]
  createdAt       DateTime @default(now())

  brand      Brand       @relation(fields: [brandId], references: [id], onDelete: Cascade)
  influencer Influencer? @relation(fields: [influencerId], references: [id])
  rights     ContentRightsRecord?
  usages     ContentUsageRecord[]

  @@index([brandId])
  @@index([influencerId])
  @@index([mediaType])
}

model ContentRightsRecord {
  id           String    @id @default(cuid())
  ugcContentId String    @unique
  licenseType  String // EXCLUSIVE, NON_EXCLUSIVE, LIMITED
  usageRights  String[]
  territory    String?
  duration     Int?
  expiresAt    DateTime?
  agreementUrl String?

  ugcContent UGCContent @relation(fields: [ugcContentId], references: [id], onDelete: Cascade)

  @@index([expiresAt])
}

model ContentUsageRecord {
  id           String   @id @default(cuid())
  ugcContentId String
  platform     String
  usageType    String // AD, SOCIAL_POST, WEBSITE, EMAIL
  url          String?
  usedAt       DateTime @default(now())

  ugcContent UGCContent @relation(fields: [ugcContentId], references: [id], onDelete: Cascade)

  @@index([ugcContentId])
}

// ---------- Module 15: Notification & Alert Center ----------

model AlertRule {
  id        String   @id @default(cuid())
  userId    String
  name      String
  eventType String
  conditions Json?
  channels  String[]
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isActive])
}

model NotificationPreference {
  id              String  @id @default(cuid())
  userId          String  @unique
  emailEnabled    Boolean @default(true)
  pushEnabled     Boolean @default(true)
  digestFrequency String  @default("INSTANT")
  mutedCategories String[]
  quietHoursStart String?
  quietHoursEnd   String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}
